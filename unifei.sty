%%
%% Customizações do abnTeX2 (http://abnTeX2.googlecode.com) para a Universidade Federal de Itajubá
%%
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
%% This work has the LPPL maintenance status `maintained'.
%% 
%% The Current Maintainer of this work is Ricardo Carlini Sperandio, rcarlini@gmail.com
%%
%% Further information about abnTeX2 are available on http://abntex2.googlecode.com/
%%
\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{unifei}[2020/01/01 v1 AbnTeX2-UNIFEI]


% -----------------------------------------------------------------------------
% Pacotes
% -----------------------------------------------------------------------------
\usepackage[T1]{fontenc}                       % Seleção de codigos de fonte.
\usepackage[utf8]{inputenc}                    % Cconversão automática dos acentos
\usepackage{indentfirst}                       % Indenta o primeiro parágrafo de cada seção
\usepackage{color}                             % Controle das cores
\usepackage{graphicx}                          % Inclusão de gráficos
\usepackage{microtype}                         % Para melhorias de justificação
\usepackage{enumitem}                          % Para realizar enumerações com ítens
\frenchspacing                                 % Retira espaço extra obsoleto entre as frases
\usepackage{mathptmx}                          % Fonte Times New Roman
\usepackage{amsmath,amssymb}                   % Símbolos matematicos
\usepackage[brazilian,hyperpageref]{backref}   % Paginas com as citações na bibliografia
\usepackage[alf,abnt-emphasize=bf]{abntex2cite}% Citações padrão ABNT
% -----------------------------------------------------------------------------


% -----------------------------------------------------------------------------
% Configurações gerais do PDF gerado (cor dos links, etc)
% -----------------------------------------------------------------------------
\makeatletter
\hypersetup{
	%pagebackref=true,
	pdftitle={\@title}, 
	pdfauthor={\@author},
	pdfsubject={\imprimirpreambulo},
	pdfcreator={\@author},
	colorlinks=true,    % Links coloridos. Falso para criar caixas ao redor
	linkcolor=black,    % Cor de links internos (seções, etc)
	citecolor=black,    % Cor de links para a bibliografia
	filecolor=magenta,  % Cor de links para arquivos
	urlcolor=blue,      % Cor de links para URLs da web
	bookmarksdepth=4
}
\makeatother
% -----------------------------------------------------------------------------


% -----------------------------------------------------------------------------
% Configuração do sumário
% -----------------------------------------------------------------------------
% Modifica o espaçamento no sumário
\setlength{\cftbeforeparagraphskip}{0pt}
\setlength{\cftbeforesubsectionskip}{0pt}
\setlength{\cftbeforesectionskip}{0pt}
\setlength{\cftbeforesubsubsectionskip}{0pt}
\setlength{\cftbeforechapterskip}{0pt}

% Modifica o título das seções
% Seção primária (chapter): Caixa alta, Negrito, tamanho 12
\makeatletter
\settocpreprocessor{chapter}{%
	\let\tempf@rtoc\f@rtoc%
	\def\f@rtoc{%
		\texorpdfstring{\bfseries\MakeTextUppercase{\tempf@rtoc}}{\tempf@rtoc}}%
}
\makeatother

% Seção secundária (section): Negrito, tamanho 12
\renewcommand*{\cftsectionfont}{\bfseries}
% Seção terciária (subsection): tamanho 12
\renewcommand*{\cftsubsectionfont}{\normalfont}
% Seção quaternária (subsubsection): tamanho 12
\renewcommand*{\cftsubsubsectionfont}{\normalfont}
% Seção quinária (subsubsubsection): tamanho 12
\renewcommand*{\cftparagraphfont}{\normalfont}

% Modifica número de página sem negrito
\renewcommand{\cftchapterpagefont}{\normalfont}   
\renewcommand{\cftsectionpagefont}{\normalfont} 

% Modifica tabulação sem negrito
\renewcommand*{\cftchapterleader}{
	\normalfont\cftdotfill{\cftsectiondotsep}}
% -----------------------------------------------------------------------------


% -----------------------------------------------------------------------------
% Formatação das páginas
% -----------------------------------------------------------------------------
% Definição das margens e espaçamentos
\setlrmarginsandblock{3cm}{2cm}{*} % externa / interna
\setulmarginsandblock{3cm}{2cm}{*} % superior / inferior
\checkandfixthelayout

% Recuo do parágrafo
\setlength{\parindent}{1.3cm}
% Sem espaço entre os parágrafos
\setlength{\parskip}{0cm}

% Espaçamento nos títulos
% Seção primária (chapter)
\setlength{\beforechapskip}{\onelineskip}
\setlength{\afterchapskip}{\onelineskip}
% Seção secundária (section)
\setbeforesecskip{\onelineskip}
\setaftersecskip{\onelineskip}
% Seção terciária (subsection)
\setbeforesubsecskip{\onelineskip}
\setaftersubsecskip{\onelineskip}
% Seção quaternária (subsubsection)
\setbeforesubsubsecskip{\onelineskip}
\setaftersubsubsecskip{\onelineskip}

% Modifica o título das seções
% Seção primária (chapter): negrito, maiúsculo
\renewcommand{\ABNTEXchapterfont}{\bfseries}
\renewcommand{\ABNTEXchapterfontsize}{\normalsize}
\setboolean{ABNTEXupperchapter}{true}
% Seção secundária (section): negrito
\renewcommand{\ABNTEXsectionfont}{\bfseries}
\renewcommand{\ABNTEXsectionfontsize}{\normalsize}
% Seção terciária (subsection)
\renewcommand{\ABNTEXsubsectionfont}{}
\renewcommand{\ABNTEXsubsectionfontsize}{\normalsize}
% Seção quaternária (subsubsection)
\renewcommand{\ABNTEXsubsubsectionfont}{}
\renewcommand{\ABNTEXsubsubsectionfontsize}{\normalsize}
\setsubsubsecheadstyle{\ABNTEXsubsubsectionfont\ABNTEXsubsubsectionfontsize
	\ABNTEXsubsubsectionupperifneeded]}
% Seção quinária (subsubsection)
\setparaheadstyle{\normalfont\ABNTEXsubsubsectionfont\ABNTEXsubsubsectionfontsize}
% -----------------------------------------------------------------------------


% -----------------------------------------------------------------------------
% Novos comandos
% -----------------------------------------------------------------------------
\newcommand{\quadroname}{Quadro}
\newcommand{\listofquadrosname}{Lista de quadros}

\newfloat[chapter]{quadro}{loq}{\quadroname}
\newlistof{listofquadros}{loq}{\listofquadrosname}
\newlistentry{quadro}{loq}{0}

% configurações para atender às regras da ABNT
\setfloatadjustment{quadro}{\centering}
\counterwithout{quadro}{chapter}
\renewcommand{\cftquadroname}{\quadroname\space} 
\renewcommand*{\cftquadroaftersnum}{\hfill--\hfill}

\setfloatlocations{quadro}{hbtp}

% Comando departamento
\providecommand{\imprimirdepartamento}{}
\newcommand{\departamento}[1]{\renewcommand{\imprimirdepartamento}{#1}}

% Comando turma
\providecommand{\imprimirturma}{}
\newcommand{\turma}[1]{\renewcommand{\imprimirturma}{#1}}

% Comando subtítulo
\providecommand{\imprimirsubtitulo}{}
\newcommand{\subtitulo}[1]{\renewcommand{\imprimirsubtitulo}{#1}}

% Configurações do pacote backref
% Usado sem a opção hyperpageref de backref
\renewcommand{\backrefpagesname}{Citado na(s) página(s):~}
% Texto padrão antes do número das páginas
\renewcommand{\backref}{}
% Define os textos da citação
\renewcommand*{\backrefalt}[4]{
	\ifcase #1 %
	Nenhuma citação no texto.%
	\or
	Citado na página #2.%
	\else
	Citado #1 vezes nas páginas #2.%
	\fi}%
% -----------------------------------------------------------------------------


% -----------------------------------------------------------------------------
% Formatação da capa
% -----------------------------------------------------------------------------
\renewcommand{\imprimircapa}{
	\begin{capa}
		\center
		% Imprime instituição
		{\ABNTEXchapterfont\bfseries\MakeUppercase\imprimirinstituicao}\par
		% Imprime departamento
		{\ABNTEXchapterfont\bfseries\MakeUppercase\imprimirdepartamento}\noindent\par

		\bigskip

		% Imprime autor
		{\ABNTEXsubsectionfont\MakeUppercase\imprimirautor}\noindent\par
		% Imprime turma
		{\ABNTEXsubsectionfont\imprimirturma}\noindent\par
		
		\vfill

		\begin{minipage}{\textwidth}
			\centering
			% Imprime título
			{\ABNTEXchapterfont\bfseries\MakeUppercase\imprimirtitulo} \par
			% Imprime subtítulo
			{\ABNTEXsubsectionfont\imprimirsubtitulo}
		\end{minipage}

		\vfill

		% Imprime local
		{\bfseries\MakeUppercase\imprimirlocal\\}
		% Imprime data
		{\bfseries\imprimirdata}
	\end{capa}
}
% -----------------------------------------------------------------------------


% -----------------------------------------------------------------------------
% Formatação da folha de rosto
% -----------------------------------------------------------------------------
\makeatletter
\renewcommand{\folhaderostocontent}{
	\begin{center}
		% Imprime autor
		{\ABNTEXsubsectionfont\MakeUppercase\imprimirautor}\noindent\par
		
        %\vspace*{10cm}
		\vfill
		
		\begin{minipage}{\textwidth}
			\centering
			% Imprime título
			{\ABNTEXchapterfont\bfseries\MakeUppercase\imprimirtitulo} \par
			% Imprime subtítulo
			{\ABNTEXsubsectionfont\imprimirsubtitulo}
		\end{minipage}
		
		\hspace{.45\textwidth}
		\begin{minipage}{.5\textwidth}
			\SingleSpacing
			% Imprime preâmbulo
			\imprimirpreambulo
			\bigskip
			% Imprime orientador
			\noindent \par {\bfseries Orientador:} \imprimirorientador
		\end{minipage}
		
		\vfill

		% Imprime local
		{\bfseries\MakeUppercase\imprimirlocal\\}
		% Imprime data
		{\bfseries\imprimirdata}
	\end{center}
}
% -----------------------------------------------------------------------------